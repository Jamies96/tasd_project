<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Quindici Game</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel='stylesheet' type='text/css' href='stile.css'>

</head>

<body>
    <h1>15 puzzle game</h1>
    <table></table>

    <button type="button" id="newGame">New Game</button>
    <p>Moves: <span id="numberMoves"></span></p>
    <script>
        function drawTable() {
            for (let row = 0; row < 4; row++) {
                document.getElementsByTagName("table")[0].innerHTML +=
                    "<tr>" +
                    "<td><button type='button' class='tiles' id='" + (row * 4 + 1) + "'>" + (row * 4 + 1) + "</button></td>" +
                    "<td><button type='button' class='tiles' id='" + (row * 4 + 2) + "'>" + (row * 4 + 2) + "</button></td>" +
                    "<td><button type='button' class='tiles' id='" + (row * 4 + 3) + "'>" + (row * 4 + 3) + "</button></td>" +
                    "<td><button type='button' class='tiles' id='" + (row * 4 + 4) + "'>" + (row * 4 + 4) + "</button></td>" +
                    "</tr>";
            }
            document.getElementById("16").innerHTML = "";
            document.getElementById("16").style.visibility = "hidden";

        }

        function drawTable2() {
            for (let row = 0; row < 4; row++) {
                let html = "<tr>";
                for (let col = 1; col <= 4; col++) {
                    html += "<td><button type='button' class='tiles' id='" + (row * 4 + col) + "'>" + (row * 4 + col) + "</button></td>";
                }
                html += "</tr>";
                document.getElementsByTagName("table")[0].innerHTML += html;
            }
            document.getElementById("16").innerHTML = "";
            document.getElementById("16").style.visibility = "hidden";
        }

        function countMoves() {
            count++;
            document.getElementById("numberMoves").innerHTML = count;
        }

        function lookAbove(myId, myLabel) {
            if (document.getElementById(myId - 4).innerHTML == "") {
                document.getElementById(myId - 4).innerHTML = myLabel;
                document.getElementById(myId - 4).style.visibility = "visible";
                document.getElementById(myId).innerHTML = "";
                document.getElementById(myId).style.visibility = "hidden";
                countMoves();
            }

        }

        function lookBelow(myId, myLabel) {
            if (document.getElementById(myId + 4).innerHTML == "") {
                document.getElementById(myId + 4).innerHTML = myLabel;
                document.getElementById(myId + 4).style.visibility = "visible";
                document.getElementById(myId).innerHTML = ""
                document.getElementById(myId).style.visibility = "hidden";
                countMoves();
            }

        }

        function lookNext(myId, myLabel) {
            if (document.getElementById(myId + 1).innerHTML == "") {
                document.getElementById(myId + 1).innerHTML = myLabel;
                document.getElementById(myId + 1).style.visibility = "visible";
                document.getElementById(myId).innerHTML = "";
                document.getElementById(myId).style.visibility = "hidden";
                countMoves();
            }

        }

        function lookPrevious(myId, myLabel) {
            if (document.getElementById(myId - 1).innerHTML == "") {
                document.getElementById(myId - 1).innerHTML = myLabel;
                document.getElementById(myId - 1).style.visibility = "visible";
                document.getElementById(myId).innerHTML = ""
                document.getElementById(myId).style.visibility = "hidden";
                countMoves();
            }

        }

        function moveTile(event) {
            let id = parseInt(event.path[0].id);
            let label = document.getElementById(id).innerHTML;
            switch (id) {
                case 1:
                    lookNext(id, label);
                    lookBelow(id, label);
                    break;
                case 2:
                case 3:
                    lookNext(id, label);
                    lookPrevious(id, label);
                    lookBelow(id, label);
                    break;
                case 4:
                    lookPrevious(id, label);
                    lookBelow(id, label);
                    break;
                case 5:
                case 9:
                    lookAbove(id, label);
                    lookBelow(id, label);
                    lookNext(id, label);

                    break;
                case 6:
                case 7:
                case 10:
                case 11:
                    lookAbove(id, label);
                    lookBelow(id, label);
                    lookNext(id, label);
                    lookPrevious(id, label);
                    break;
                case 8:
                case 12:
                    lookAbove(id, label);
                    lookBelow(id, label);
                    lookPrevious(id, label);
                    break;
                case 13:
                    lookAbove(id, label);
                    lookNext(id, label);
                    break;
                case 14:
                case 15:
                    lookAbove(id, label);
                    lookNext(id, label);
                    lookPrevious(id, label);
                    break;
                case 16:
                    lookAbove(id, label);
                    lookPrevious(id, label);
                    break;
            }
        }

        function getRandomInt(max) {
            return Math.floor(Math.random() * max);
        }


        function blendTiles(event) {
            const array = [];
            for (let i = 1; i <= 16; i++) {
                array.push(i);
            }
            for (let i = 0; i < 1000; i++) {
                let removedElement = array.pop();
                let randomPosition = getRandomInt(16);
                array.splice(randomPosition, 0, removedElement);
            }
            console.log(array);
            for (let i = 0; i < array.length; i++) {
                let tile = document.getElementsByClassName("tiles")[i];
                tile.innerHTML = array[i];
                if (tile.innerHTML == "16") {
                    tile.innerHTML = "";
                    tile.style.visibility = "hidden";
                } else {
                    tile.style.visibility = "visible";
                }

            }
        }

        drawTable2();
        let count = 0;
        document.getElementById("numberMoves").innerHTML = count;

        document.getElementById("newGame").addEventListener("click", blendTiles);


        for (let button of document.getElementsByClassName("tiles")) {
            button.addEventListener("click", moveTile);
        }
    </script>
</body>

</html>