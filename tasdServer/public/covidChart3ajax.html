<!DOCTYPE html>
<!-- saved from url=(0065)https://www.chartjs.org/samples/latest/scales/time/financial.html -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Line Chart</title>
    <script async="" src="./javascripts/analytics.js"></script>
    <script src="./javascripts/moment.min.js"></script>
    <script src="./javascripts/Chart.min.js"></script>
    <script src="./javascripts/utils.js"></script>
    <style>
        canvas {
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
        }
    </style>
    <style type="text/css">/* Chart.js */
    @keyframes chartjs-render-animation {
        from {
            opacity: .99
        }
        to {
            opacity: 1
        }
    }

    .chartjs-render-monitor {
        animation: chartjs-render-animation 1ms
    }

    .chartjs-size-monitor, .chartjs-size-monitor-expand, .chartjs-size-monitor-shrink {
        position: absolute;
        direction: ltr;
        left: 0;
        top: 0;
        right: 0;
        bottom: 0;
        overflow: hidden;
        pointer-events: none;
        visibility: hidden;
        z-index: -1
    }

    .chartjs-size-monitor-expand > div {
        position: absolute;
        width: 1000000px;
        height: 1000000px;
        left: 0;
        top: 0
    }

    .chartjs-size-monitor-shrink > div {
        position: absolute;
        width: 200%;
        height: 200%;
        left: 0;
        top: 0
    }</style>
</head>

<body>
<div style="width:1000px">
    <div class="chartjs-size-monitor">
        <div class="chartjs-size-monitor-expand">
            <div class=""></div>
        </div>
        <div class="chartjs-size-monitor-shrink">
            <div class=""></div>
        </div>
    </div>
    <p>This example demonstrates a time series scale by drawing a Coronavirus cases line chart using just the core library.</p>
    <canvas id="chart1" width="2000" height="600" class="chartjs-render-monitor"
            style="display: block; height: 300px; width: 1000px;"></canvas>
</div>
<br>
<br>
Chart Type:
<select id="type">
    <option value="line">Line</option>
    <option value="bar">Bar</option>
</select>
<select id="state">
</select>
<button id="update">update</button>
<!--<script src="./javascripts/us-states.js"></script>-->
<script src="./javascripts/usStateList.js"></script>
<script>
    for (s of stateList) {
      if (s === 'Arizona') {
        document.getElementById('state').innerHTML += '<option value="Arizona" selected="">Arizona</option>';
      } else {
        document.getElementById('state').innerHTML += '<option value="' + s + '">' + s + '</option>';
      }
    }
</script>
<script>

  function generateData() {
    var unit = "day";

    var state = document.getElementById('state').value;

    function getdata(item, state) {
      let pos = item.indexOf(state);
      if (pos !== -1) { // Ã¨ lo stato voluto
        let array = item.split(",");
        let date = moment(array[0], 'DD/MM/YYYY');
        let cases = parseInt(array[3]);
        return {
          t: date.valueOf(),
          y: cases
        };
      } else {
        return {};
      }
    }

    function unitLessThanDay() {
      return unit === 'second' || unit === 'minute' || unit === 'hour';
    }

    function beforeNineThirty(date) {
      return date.hour() < 9 || (date.hour() === 9 && date.minute() < 30);
    }

    // Returns true if outside 9:30am-4pm on a weekday
    function outsideMarketHours(date) {
      if (date.isoWeekday() > 5) {
        return true;
      }
      if (unitLessThanDay() && (beforeNineThirty(date) || date.hour() > 16)) {
        return true;
      }
      return false;
    }

    function randomNumber(min, max) {
      return Math.random() * (max - min) + min;
    }

    function randomBar(date, lastClose) {
      var open = randomNumber(lastClose * 0.95, lastClose * 1.05).toFixed(2);
      var close = randomNumber(open * 0.95, open * 1.05).toFixed(2);
      return {
        t: date.valueOf(),
        y: close
      };
    }

    var date = moment('01/01/1990', 'DD/MM/YYYY');
    var now = moment();
    var arrayCovid = dataCovid.split("\n");
    var data = [];
    var lessThanDay = unitLessThanDay();
    for (item of arrayCovid) {
      let pairCovid = getdata(item, state);
      if (!(Object.keys(pairCovid).length === 0 && pairCovid.constructor === Object) )
        data.push(pairCovid);
    }
    return data;
  }

    var dataCovid = "";
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function () {
      if (xhttp.readyState == 4 && xhttp.status == 200) {
        dataCovid = xhttp.responseText;
        start();
      }
    };
    xhttp.open("GET", "tasd/datiCovid.csv", true);
    xhttp.send();

    function start() {
    var ctx = document.getElementById('chart1').getContext('2d');
    ctx.canvas.width = 1000;
    ctx.canvas.height = 300;

    var color = Chart.helpers.color;
    var cfg = {
      data: {
        datasets: [{
          label: document.getElementById('state').value,
          backgroundColor: color(window.chartColors.red).alpha(0.5).rgbString(),
          borderColor: window.chartColors.red,
          data: generateData(),
          type: 'line',
          pointRadius: 0,
          fill: false,
          lineTension: 0,
          borderWidth: 2
        }]
      },
      options: {
        animation: {
          duration: 0
        },
        scales: {
          xAxes: [{
            type: 'time',
            distribution: 'series',
            offset: true,
            ticks: {
              major: {
                enabled: true,
                fontStyle: 'bold'
              },
              source: 'data',
              autoSkip: true,
              autoSkipPadding: 75,
              maxRotation: 0,
              sampleSize: 100
            },
            afterBuildTicks: function (scale, ticks) {
              var majorUnit = scale._majorUnit;
              var firstTick = ticks[0];
              var i, ilen, val, tick, currMajor, lastMajor;

              val = moment(ticks[0].value);
              if ((majorUnit === 'minute' && val.second() === 0)
                || (majorUnit === 'hour' && val.minute() === 0)
                || (majorUnit === 'day' && val.hour() === 9)
                || (majorUnit === 'month' && val.date() <= 3 && val.isoWeekday() === 1)
                || (majorUnit === 'year' && val.month() === 0)) {
                firstTick.major = true;
              } else {
                firstTick.major = false;
              }
              lastMajor = val.get(majorUnit);

              for (i = 1, ilen = ticks.length; i < ilen; i++) {
                tick = ticks[i];
                val = moment(tick.value);
                currMajor = val.get(majorUnit);
                tick.major = currMajor !== lastMajor;
                lastMajor = currMajor;
              }
              return ticks;
            }
          }],
          yAxes: [{
            gridLines: {
              drawBorder: false
            },
            scaleLabel: {
              display: true,
              labelString: 'Cases #'
            }
          }]
        },
        tooltips: {
          intersect: false,
          mode: 'index',
          callbacks: {
            label: function (tooltipItem, myData) {
              var label = myData.datasets[tooltipItem.datasetIndex].label || '';
              if (label) {
                label += ': ';
              }
              label += parseFloat(tooltipItem.value).toFixed(2);
              return label;
            }
          }
        }
      }
    };

    var chart = new Chart(ctx, cfg);

    document.getElementById('update').addEventListener('click', function () {
      var type = document.getElementById('type').value;
      var dataset = chart.config.data.datasets[0];
      dataset.type = type;
      dataset.data = generateData();
      dataset.label = document.getElementById('state').value;
      chart.update();
    });
  }

</script>


</body>
</html>
