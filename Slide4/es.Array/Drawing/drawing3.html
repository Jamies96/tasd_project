<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        input[type=range] {
            -webkit-appearance: none;
            height: 15px;
            border-radius: 5px;
            background: SILVER;
            outline: none;
            opacity: 0.7;
            -webkit-transition: .2s;
            transition: opacity .2s;
        }
        
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: MAGENTA;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <!DOCTYPE html>
    <html>

    <body>
        <canvas id="myCanvas" width="400" height="200" style="border:1px solid black; background-color: yellow;">
            Your browser does not support the canvas element.
        </canvas>
        <div id="tag">
            <p id="demo"></p>
        </div>
        <p>
            <strong>Tip:</strong> Try to click different places in the canvas.
        </p>
        <div>
            <input type="range" id="myRange" min="0" max="400" step="10">
            <label for="myRange">Set threshold</label>
            <p>Threshold value: <span id="myFilter"></span></p>
        </div>
        <button type="button" id="button">Draw shadow</button>
        <script>
            /***FUNCTIONS***/

            /**
             * Draw a vertical line inside the canvas given a position (x) and a color.
             * @param {int} x - the x coordinate where draw the line
             * @param {color} color - the color of the drawed line
             */
            function drawLine(x, color) {
                ctx.beginPath(); // start a new drawing
                ctx.moveTo(x, 0); // starting point
                ctx.lineTo(x, 200); // next point
                ctx.lineWidth = 2;
                ctx.strokeStyle = color; // set line color
                ctx.stroke(); // make the line visible
            }

            function drawPoint(x, y, shadow = false) {
                ctx.beginPath(); // start a new drawing
                ctx.arc(x, y, 5, 0, 2 * Math.PI);
                // draw an arc (centerX, centerY, radius, from, to)
                if (!shadow) {
                    if (x < slider.value)
                        ctx.fillStyle = "red"; // on the left half
                    else
                        ctx.fillStyle = "blue"; // on the right half
                } else {
                    ctx.fillStyle = "lightgrey";
                }
                ctx.fill();
                // actually draw the picture (make it visible)
            }

            function drawShadow(event) {
                let pointsShadow = cooPoint.map(function(value) {
                    return [(value[0] + 3), value[1]];
                });
                for (let i = 0; i < pointsShadow.length; i++) {
                    drawPoint(pointsShadow[i][0], pointsShadow[i][1], true);
                }
                for (let tuple of cooPoint) {
                    drawPoint(tuple[0], tuple[1]);
                }
            }



            function drawPointWhenClickCanvas(event) {
                let cX = event.clientX;
                let cY = event.clientY;

                let coo = [cX, cY];
                cooPoint.push(coo);
                drawPoint(cX, cY);

                document.getElementById("demo").innerHTML = "Coordinate of last click: X = " + cX + ", Y = " + cY;
            }



            function writeSliderCurrentValue(event) {
                document.getElementById("myFilter").innerHTML = slider.value;
            }



            function redrawSliderAndPoints(event) {
                let newValue = parseInt(slider.value);
                drawLine(oldValueSlider, "yellow");
                drawLine(newValue, "magenta");
                let filteredPoints;
                if (oldValueSlider < newValue) {
                    filteredPoints = cooPoint.filter(function(tuple) {
                        return oldValueSlider <= tuple[0] && tuple[0] <= newValue;
                    });
                } else {
                    filteredPoints = cooPoint.filter(function(tuple) {
                        return newValue <= tuple[0] && tuple[0] <= oldValueSlider;
                    });
                }
                for (let tuple of filteredPoints) {
                    drawPoint(tuple[0], tuple[1]);
                }
                oldValueSlider = newValue;
            }


            /***/

            const canvas = document.getElementById("myCanvas");
            // get access to the canvas
            const ctx = canvas.getContext("2d");
            // to support 2d drawing
            const getPoint = document.getElementById("myCanvas");
            // to support interaction on canvas

            let cooPoint = [];

            getPoint.addEventListener("click", drawPointWhenClickCanvas)

            const slider = document.getElementById("myRange");
            slider.addEventListener("change", writeSliderCurrentValue)

            document.getElementById("myFilter").innerHTML = slider.value;
            drawLine(200, "magenta");

            /*******/

            let oldValueSlider = 200;

            slider.addEventListener("change", redrawSliderAndPoints)

            /*slider.addEventListener("change", function (event) {
                for (let tuple of cooPoint){
                    drawPoint(tuple[0], tuple[1]);
                }
            })*/

            button.addEventListener("click", drawShadow);
        </script>
    </body>

    </html>